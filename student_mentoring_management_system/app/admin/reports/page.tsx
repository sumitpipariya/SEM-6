"use client";
import React, { useState, useEffect } from 'react';

export default function AdminReportsPage() {
  const [stats, setStats] = useState({
    totalMentors: 0,
    totalMentees: 0,
    totalSessions: 0,
    avgStressLevel: 'Low'
  });

  const [reportType, setReportType] = useState('mentor-wise');

  useEffect(() => {
    // Sync stats from our Storage keys
    const staff = JSON.parse(localStorage.getItem('STAFF_STORAGE') || '[]');
    const students = JSON.parse(localStorage.getItem('STUDENT_STORAGE') || '[]');
    const assigns = JSON.parse(localStorage.getItem('ASSIGNMENT_STORAGE') || '[]');
    
    setStats({
      totalMentors: staff.length,
      totalMentees: students.length,
      totalSessions: assigns.length, // Placeholder for actual mentoring sessions
      avgStressLevel: 'Medium'
    });
  }, []);

  return (
    <div className="container-fluid py-4 animate-fade-in">
      <div className="mb-4">
        <h2 className="fw-black text-dark mb-1">Reports & Analytics</h2>
        <p className="text-secondary fw-medium">Comprehensive university mentoring insights</p>
      </div>

      {/* Analytics Overview Cards */}
      <div className="row g-4 mb-5">
        {[
          { label: 'Active Mentors', value: stats.totalMentors, icon: 'engineering', color: 'indigo' },
          { label: 'Total Mentees', value: stats.totalMentees, icon: 'school', color: 'blue' },
          { label: 'Sessions Conducted', value: stats.totalSessions, icon: 'forum', color: 'success' },
          { label: 'Avg. Stress Level', value: stats.avgStressLevel, icon: 'psychology', color: 'warning' }
        ].map((item, idx) => (
          <div className="col-md-3" key={idx}>
            <div className="card-main border-0 shadow-sm bg-white p-4">
              <div className={`avatar-md-circle bg-${item.color}-soft text-${item.color} mb-3`}>
                <span className="material-symbols-rounded">{item.icon}</span>
              </div>
              <h3 className="fw-black mb-0">{item.value}</h3>
              <p className="extra-small fw-bold text-muted text-uppercase ls-1 mb-0">{item.label}</p>
            </div>
          </div>
        ))}
      </div>

      {/* Report Generator Section */}
      <div className="card-main border-0 shadow-sm bg-white overflow-hidden">
        <div className="p-4 border-bottom bg-light d-flex justify-content-between align-items-center">
          <div className="d-flex gap-3">
            <button 
              className={`btn rounded-pill px-4 fw-bold ${reportType === 'mentor-wise' ? 'btn-indigo-glow' : 'btn-light border'}`}
              onClick={() => setReportType('mentor-wise')}
            >
              Mentor-wise Report
            </button>
            <button 
              className={`btn rounded-pill px-4 fw-bold ${reportType === 'progress' ? 'btn-indigo-glow' : 'btn-light border'}`}
              onClick={() => setReportType('progress')}
            >
              Progress Analytics
            </button>
          </div>
          <button className="btn btn-outline-dark rounded-pill fw-bold px-4">
            <span className="material-symbols-rounded align-middle me-2">download</span> Export PDF
          </button>
        </div>

        <div className="table-responsive p-0">
          <table className="table table-hover align-middle mb-0">
            <thead className="bg-light-soft text-uppercase extra-small fw-bold text-secondary">
              <tr>
                <th className="ps-4 py-3">Reference</th>
                <th className="py-3">Details</th>
                <th className="py-3">Status/Level</th>
                <th className="py-3">Last Activity</th>
                <th className="pe-4 py-3 text-end">Trends</th>
              </tr>
            </thead>
            <tbody>
              {/* This would map through your Session & Assignment Data */}
              <tr className="border-bottom">
                <td className="ps-4">
                  <div className="fw-bold text-dark">Dr. Rajesh Kumar</div>
                  <div className="extra-small text-muted">ID: 101</div>
                </td>
                <td>
                  <div className="small fw-medium">Assigned to: 5 Mentees</div>
                  <div className="extra-small text-muted">IT Department</div>
                </td>
                <td>
                  <span className="badge bg-success-soft text-success rounded-pill px-3">Completed 90%</span>
                </td>
                <td className="small text-secondary">24 Jan 2026</td>
                <td className="pe-4 text-end">
                   <div className="progress" style={{height: '6px', width: '100px', marginLeft: 'auto'}}>
                      <div className="progress-bar bg-indigo" style={{width: '85%'}}></div>
                   </div>
                </td>
              </tr>
              <tr className="border-bottom">
                <td className="ps-4">
                  <div className="fw-bold text-dark">Jane Smith</div>
                  <div className="extra-small text-muted">ENR2026002</div>
                </td>
                <td>
                  <div className="small fw-medium">Learner Type: Fast</div>
                  <div className="extra-small text-muted">Mentor: Prof. Anita</div>
                </td>
                <td>
                  <span className="badge bg-warning-soft text-warning rounded-pill px-3">Stress: Medium</span>
                </td>
                <td className="small text-secondary">18 Jan 2026</td>
                <td className="pe-4 text-end">
                   <div className="progress" style={{height: '6px', width: '100px', marginLeft: 'auto'}}>
                      <div className="progress-bar bg-warning" style={{width: '40%'}}></div>
                   </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <style jsx>{`
        .bg-indigo-soft { background: #eef2ff; color: #6366f1; }
        .bg-blue-soft { background: #eff6ff; color: #2563eb; }
        .bg-success-soft { background: #ecfdf5; color: #10b981; }
        .bg-warning-soft { background: #fffbeb; color: #f59e0b; }
        
        .avatar-md-circle {
          width: 48px;
          height: 48px;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 14px;
        }

        .ls-1 { letter-spacing: 0.5px; }
      `}</style>
    </div>
  );
}